<!DOCTYPE html>
<html>

<head>
	<title>X___X</title>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://www.samclarke.com/assets/migrating-to-hugo/monokai.css" rel="stylesheet">
	<style>
		.btn {
			width: 83.5px !important;
		}

		.data-input {
			margin-right: 5px !important;
			margin-left: 5px !important;
		}
	</style>

</head>

<body>
	<div id="app" class="container-fluid">
		<div class="row">
			<div class="col-md-12">
				<h1>Slim REST Generator</h1>
			</div>
		</div>

		<hr>
		<div class="row">
			<div class="col-md-6">
				<div class="form-group">
					<div class="form-inline">
						<input v-model="autoSave" v-bind:id="autoSave" v-on:click="save" type="checkbox" class="data-input" /><label>Save to Local Storage | </label>
						<input v-model="filter" v-bind:id="filter" v-on:click="save(); generateCode();" type="checkbox" class="data-input" /><label>Filter | </label>
						<input v-model="tryCatch" v-bind:id="tryCatch" v-on:click="save(); generateCode();" type="checkbox" class="data-input" /><label>Try Catch | </label>
						<button v-on:click="reset" class="btn btn-sm btn-danger pull-right">Reset</button>
					</div>
				</div>


				<div class="form-group">
					<div class="form-inline">
						<label>Request Method : </label>
						<button v-on:click="selectType('GET');" v-bind:class="{ 'btn  btn-success' : btn.GET,    'btn btn-default': !btn.GET }">GET</button>
						<button v-on:click="selectType('POST')" v-bind:class="{ 'btn btn-success' : btn.POST,   'btn btn-default': !btn.POST }">POST</button>
						<button v-on:click="selectType('PUT')" v-bind:class="{ 'btn btn-success' : btn.PUT,    'btn btn-default': !btn.PUT }">PUT</button>
						<button v-on:click="selectType('DELETE')" v-bind:class="{ 'btn btn-success' : btn.DELETE, 'btn btn-default': !btn.DELETE }">DELETE</button>
					</div>
				</div>

				<div class="form-group">
					<div class="form-inline">
						<label>Controller Name : </label>
						<input v-model="root" v-on:keyup="generateCode" class="form-control" placeholder="Controller Name" required>
					</div>
				</div>

				<div class="form-group">
					<div class="form-inline">
						<label>Function Name : </label>
						<input v-model="funName" v-on:keyup="generateCode" class="form-control" placeholder="Function Name" required>
					</div>
				</div>

				<div class="form-group">
					<div class="form-inline">
						<a href="#" v-on:click="addParam"><span class="glyphicon glyphicon-plus"></span> Add Parmas</a>
					</div>
				</div>

				<div class="form-group">
					<div v-for="item in params" class="form-group">
						<input v-model="item.name" v-on:keyup="generateCode(); save();" class="form-control" placeholder="Param Name" required>
					</div>
				</div>
			</div>

			<div class="col-md-6">
				<div class="form-group">
					<div v-if="output!=''" class="row">
						<pre style="height: 350px; width: 99%"><code class="language-php" v-html="output"></code></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- End Of Container -->

	<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.4.4/vue.js"></script>
	<script src="https://www.samclarke.com/js/prism.js"></script>

	<script>
		// https://github.com/Ahrengot/Monokai-theme-for-Prism.js
		// https://schier.co/blog/2013/01/07/how-to-re-run-prismjs-on-ajax-content.html
		var app = new Vue({
			el: '#app',
			data: {
				autoSave: true,
				filter: false,
				tryCatch : false,
				btn: { GET: false, POST: false, PUT: false, DELETE: false },
				root: '',
				funName: '',
				type: '',
				params: [],
				output: ''
			},
			methods: {
				selectType: function (x) {
					this.type = x
					this.btn = { GET: false, POST: false, PUT: false, DELETE: false }

					if (x == 'GET') this.btn.GET = true
					else if (x == 'POST') this.btn.POST = true
					else if (x == 'PUT') this.btn.PUT = true
					else if (x == 'DELETE') this.btn.DELETE = true
				
					this.generateCode()
				},
				addParam: function () {
					this.params.push({ name: '' });
					this.generateCode()
				},
				generateCode: function () {
					this.output = ''
					this.output += '$app->' + this.type.toLowerCase()
					this.output += '("{{url}}", function (Request $request, Response $response'

					if (this.type == 'GET') {
						this.output += ', $args) { \n\n'
						for (i = 0; i < this.params.length; i++) {

							if (this.filter)
								this.output += '\t$' + this.params[i].name + ' = filter_var($request->getAttribute("' + this.params[i].name + '"), FILTER_SANITIZE_STRING);\n'
							else
								this.output += '\t$' + this.params[i].name + ' = $request->getAttribute("' + this.params[i].name + '");\n'

						}

					} else if (this.type == 'POST') {
						this.output += ') { \n\n'
						this.output += '\t$data = $request->getParsedBody();\n'
						for (i = 0; i < this.params.length; i++) {

							if (this.filter)
								this.output += '\t$' + this.params[i].name + ' = filter_var($data["' + this.params[i].name + '"], FILTER_SANITIZE_STRING);\n'
							else
								this.output += '\t$' + this.params[i].name + ' = $data["' + this.params[i].name + '"];\n'
						}

					}

					this.output = this.output.replace('{{url}}', this.root + '/' + this.funName + '/')

					this.output += '\n\n\t$result = [];\n'
					this.output += '\treturn $response->withjson($result, 200);\n'
					this.output += '});\n'

					setTimeout(function () { Prism.highlightAll(); }, 0);
					this.save()
				},
				save: function () {
					if (this.autoSave) {
						localStorage.tempData = JSON.stringify(this._data)
					}
					else {
						localStorage.tempData = undefined
					}
				},
				clear: function () {
					localStorage.tempData = undefined
				},
				reset: function () {
					this.clear()
					location.reload()
				}
			}
		});

		if (localStorage.tempData != undefined && localStorage.tempData != "undefined") {
			temp = JSON.parse(localStorage.tempData)
			app._data.autoSave = temp.autoSave
			app._data.filter = temp.filter
			app._data.btn = temp.btn
			app._data.root = temp.root
			app._data.funName = temp.funName
			app._data.type = temp.type
			app._data.params = temp.params
			app._data.output = temp.output
		}

		app.generateCode()
	</script>
</body>

</html>